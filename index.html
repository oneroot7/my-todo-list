<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì—…ë¬´ ì¼ì • ê´€ë¦¬</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="login-section" style="text-align: center; margin-top: 100px; display: none;">
        <div class="login-box" style="display: inline-block; padding: 40px; background: white; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1);">
            <h2 style="border: none; padding: 0; margin-bottom: 20px;">ğŸ“… ì¼ì • ê´€ë¦¬ ë¡œê·¸ì¸</h2>
            <p style="color: #666; margin-bottom: 30px;">êµ¬ê¸€ ê³„ì •ìœ¼ë¡œ ì•ˆì „í•˜ê²Œ ì‹œì‘í•˜ì„¸ìš”.</p>
            <button onclick="login()" style="padding: 15px 30px; font-size: 1.1rem; cursor: pointer; border-radius: 12px; border: none; background: #4285F4; color: white; font-weight: bold; width: 100%;">
                Google ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸
            </button>
        </div>
    </div>

    <div id="main-content" class="todo-container" style="display: none;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <span id="user-info" style="font-size: 0.9rem; color: #666; font-weight: bold;"></span>
            <button onclick="logout()" style="background: none; border: none; color: #ff4d4d; cursor: pointer; text-decoration: underline; font-size: 0.9rem;">ë¡œê·¸ì•„ì›ƒ</button>
        </div>

<div id="main-content" class="todo-container" style="display: none;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <span id="user-info" style="font-size: 0.9rem; color: #666; font-weight: bold;"></span>
        <button onclick="logout()" style="background: none; border: none; color: #ff4d4d; cursor: pointer; text-decoration: underline;">ë¡œê·¸ì•„ì›ƒ</button>
    </div>

    <div id="calendar-container" class="calendar-card">
        <div class="calendar-header">
            <button onclick="changeMonth(-1)">â—€</button>
            <h3 id="calendar-title">2024ë…„ 5ì›”</h3>
            <button onclick="changeMonth(1)">â–¶</button>
        </div>
        <div id="calendar-grid" class="calendar-grid">
            </div>
    </div>

    <h2 id="form-title" style="margin-top: 30px;">ğŸ“… ì¼ì • ë“±ë¡</h2>
    <div class="input-form">
        <label>ë‚ ì§œ</label>
        <input type="date" id="date">
        <button onclick="addSchedule()" id="submit-btn">ì¼ì • ì¶”ê°€í•˜ê¸°</button>
    </div>
    
</div>

        <hr style="margin: 40px 0; border: 0; border-top: 1px solid #eee;">

        <div class="list-header">
            <h2>ğŸ“‹ ì¼ì • ë¦¬ìŠ¤íŠ¸</h2>
            <div class="search-group">
                <input type="text" id="search-input" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥..." oninput="filterSchedules()">
                <button class="view-btn" onclick="displaySchedules(true)">ë¦¬ìŠ¤íŠ¸ ë³´ê¸°</button>
            </div>
        </div>
        <ul id="schedule-list"></ul>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // âš ï¸ ì•„ë˜ firebaseConfigë¥¼ ë³¸ì¸ì˜ Firebase ì½˜ì†” ì„¤ì •ê°’ìœ¼ë¡œ ë°˜ë“œì‹œ êµì²´í•˜ì„¸ìš”!
  const firebaseConfig = {
  apiKey: "AIzaSyBwPFxAaMFEK07WGeeVUzHb-PfBGeI4gDM",
  authDomain: "my-todo-list-3503a.firebaseapp.com",
  projectId: "my-todo-list-3503a",
  storageBucket: "my-todo-list-3503a.firebasestorage.app",
  messagingSenderId: "215467735362",
  appId: "1:215467735362:web:c6a3091978e3633668f0db",
  measurementId: "G-V7YRZG9FJ6"
};

        // Firebase ì´ˆê¸°í™”
        const app = initializeApp(firebaseConfig);
        
        // window ê°ì²´ì— ë‹´ì•„ script.jsì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ê²Œ ì„¤ì •
        window.db = getFirestore(app);
        window.auth = getAuth(app);
        window.provider = new GoogleAuthProvider();
        window.signInWithPopup = signInWithPopup;
        window.signOut = signOut;

        // ë¡œê·¸ì¸ ìƒíƒœ ì‹¤ì‹œê°„ ê°ì‹œ
onAuthStateChanged(window.auth, (user) => {
    const loginSection = document.getElementById('login-section');
    const mainContent = document.getElementById('main-content');
    const userInfo = document.getElementById('user-info');
    const authorInput = document.getElementById('teammates'); // ì‘ì„±ì ì…ë ¥ë€

    if (user) {
        // [1] ë¡œê·¸ì¸ ì„±ê³µ ìƒíƒœ
        loginSection.style.display = 'none';
        mainContent.style.display = 'block';

        // [2] ì‚¬ìš©ì ì •ë³´ í‘œì‹œ (êµ¬ê¸€ ê³„ì • ì´ë¦„)
        userInfo.innerText = `${user.displayName}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤.`;

        // [3] ì‘ì„±ì ì¹¸ì— êµ¬ê¸€ ì´ë¦„ ìë™ ì…ë ¥ ë° ìˆ˜ì • ë¶ˆê°€ ì„¤ì •
        if (authorInput) {
            authorInput.value = user.displayName;
            authorInput.readOnly = true;
        }

        // [4] ì´ˆê¸° í™”ë©´ êµ¬ì„±: ë‹¬ë ¥ ê·¸ë¦¬ê¸° + ë‚´ ì¼ì • ë¶ˆëŸ¬ì˜¤ê¸°
        renderCalendar();      // ë‹¬ë ¥ ìƒì„±
        displaySchedules(true); // ë‚´ DB ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°

        console.log("ë¡œê·¸ì¸ ì™„ë£Œ:", user.email);

    } else {
        // [5] ë¡œê·¸ì•„ì›ƒ ìƒíƒœ
        loginSection.style.display = 'block';
        mainContent.style.display = 'none';
        
        // ë°ì´í„° ì´ˆê¸°í™” (ë³´ì•ˆ ë° UI ì •ë¦¬)
        userInfo.innerText = '';
        if (authorInput) authorInput.value = '';
        
        console.log("ë¡œê·¸ì•„ì›ƒ ìƒíƒœì…ë‹ˆë‹¤.");
    }
});
    </script>

    <script src="script.js"></script>
</body>
</html>
